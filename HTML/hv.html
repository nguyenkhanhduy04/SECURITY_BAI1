<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Columnar</title>
</head>

<body>
    <h3>Columnar Transposition</h3>
    <textarea id="in" style="width:100%;height:80px">WEAREDISCOVEREDFLEEATONCE</textarea><br> Key: <input id="key" value="ZEBRA" />
    <button onclick="enc()">Encrypt</button>
    <button onclick="dec()">Decrypt</button>
    <p><textarea id="out" style="width:100%;height:80px"></textarea></p>
    <script>
        function norm(s) {
            return s.toUpperCase().replace(/[^A-Z]/g, '');
        }

        function keyOrder(key) {
            let arr = key.split('').map((ch, i) => ({
                ch,
                i
            }));
            arr.sort((a, b) => a.ch.localeCompare(b.ch));
            let order = new Array(key.length);
            for (let rank = 0; rank < key.length; rank++) order[arr[rank].i] = rank;
            return order;
        }

        function enc() {
            let s = norm(document.getElementById('in').value);
            let key = document.getElementById('key').value;
            let n = key.length,
                rows = Math.ceil(s.length / n);
            let grid = Array.from({
                length: rows
            }, () => Array(n).fill('X'));
            for (let i = 0; i < s.length; i++) grid[Math.floor(i / n)][i % n] = s[i];
            let ord = keyOrder(key);
            let ct = '';
            for (let rank = 0; rank < n; rank++) {
                for (let col = 0; col < n; col++) {
                    if (ord[col] === rank) {
                        for (let r = 0; r < rows; r++) ct += grid[r][col];
                        break;
                    }
                }
            }
            document.getElementById('out').value = ct;
        }

        function dec() {
            let ct = norm(document.getElementById('in').value);
            let key = document.getElementById('key').value;
            let n = key.length,
                rows = Math.ceil(ct.length / n);
            let ord = keyOrder(key);
            let cols = new Array(n).fill('');
            let pos = 0;
            for (let rank = 0; rank < n; rank++) {
                for (let col = 0; col < n; col++) {
                    if (ord[col] === rank) {
                        cols[col] = ct.substr(pos, rows);
                        pos += rows;
                        break;
                    }
                }
            }
            let pt = '';
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < n; c++) pt += cols[c][r] || '';
            }
            pt = pt.replace(/X+$/, '');
            document.getElementById('out').value = pt;
        }
    </script>
</body>

</html>