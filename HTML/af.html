<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Affine</title>
</head>

<body>
    <h3>Affine Cipher</h3>
    <textarea id="in" style="width:100%;height:80px"></textarea><br> a: <input id="a" value="5" /> b: <input id="b" value="8" />
    <button onclick="enc()">Encrypt</button>
    <button onclick="dec()">Decrypt</button>
    <p><textarea id="out" style="width:100%;height:80px"></textarea></p>
    <script>
        function normalize(s) {
            return s.toUpperCase().replace(/[^A-Z]/g, '');
        }

        function invMod(a, m) {
            a = ((a % m) + m) % m;
            for (let x = 1; x < m; x++)
                if ((a * x) % m === 1) return x;
            return null;
        }

        function enc() {
            let s = normalize(document.getElementById('in').value);
            let a = Number(document.getElementById('a').value),
                b = Number(document.getElementById('b').value);
            if (invMod(a, 26) === null) {
                alert('a không có nghịch đảo modulo 26');
                return;
            }
            let r = '';
            for (let ch of s) r += String.fromCharCode((a * (ch.charCodeAt(0) - 65) + b) % 26 + 65);
            document.getElementById('out').value = r;
        }

        function dec() {
            let ct = normalize(document.getElementById('in').value);
            let a = Number(document.getElementById('a').value),
                b = Number(document.getElementById('b').value);
            let ainv = invMod(a, 26);
            if (ainv === null) {
                alert('a không có nghịch đảo modulo 26');
                return;
            }
            let r = '';
            for (let ch of ct) {
                let p = (ainv * ((ch.charCodeAt(0) - 65) - b + 26)) % 26;
                r += String.fromCharCode(p + 65);
            }
            document.getElementById('out').value = r;
        }
    </script>
</body>

</html>